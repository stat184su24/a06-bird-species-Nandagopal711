---
title: "Activity: Bird Species"
author: "Nandagopal Panicker"
date: "07/22/2024"
output: html_notebook
---


# Set Up

```{r}
library(tidyverse)
library(dcData)
data("OrdwayBirds")
head(OrdwayBirds)
```
```{r}
str(OrdwayBirds)
```
This gives us a good idea of how the data set looks. 

# Activity

When you're finished with this activity, you will have a graph that shows what time of year various species appear at the Katherine Ordway Natural History Study Area in Inver Grove Heights, MN.

### Step 0

Before we begin, the book gives us some instructions to select a few key variables and clean up the date formatting.  Use the commands given in the book, but be sure to study the functions used so you know what is happening.  In this case, we select `SpeciesName`, `Month`, and `Day`. Then a `mutate()` command converts each variable to character, and then converts the resulting "character string" to a number.

```{r}
OrdwayBirds <-
  OrdwayBirds %>%
  select( SpeciesName, Month, Day ) %>%
  mutate( Month = as.numeric(as.character(Month)), 
          Day = as.numeric(as.character(Day)))

print(OrdwayBirds)
```
The month and day columns have now been converted into numerical values.


**Now, we have to import the clean data-set as well**

```{r}
data("OrdwaySpeciesNames")
head(OrdwaySpeciesNames)
```


### Step 1




```{r}
# unique species in original data (including misspellings)

n_distinct(OrdwayBirds$SpeciesName)

```
So we can see that there are 275 unique categories in the 'SpeciesName' categorical variable.

```{r}
# unique species in the clean list
n_distinct(OrdwaySpeciesNames$SpeciesNameCleaned)
```
There are 109 unique categories in the 'SpeciesNameCleaned' categorical variable.

### Step 2 : Joining the data-sets.
  


```{r}
# inspect OrdwaySpeciesNames
glimpse(OrdwaySpeciesNames)
# inner join
Joined <- OrdwayBirds %>%
  inner_join(OrdwaySpeciesNames, by = c("SpeciesName" = "SpeciesNameCleaned"))

# inspect the data after the join
head(Joined)
```


### Step 3

We want to identify the top 5-6 bird species sighted at the Katherine Ordway Natural History Study Area.

```{r}
# count sightings by species in descending order
library(tidyverse)
species_count <- Joined %>%
  count(SpeciesName, sort = TRUE)

# a hint in the text book recommends displaying the top 10 species to choose our threshold

top_10 <- head(species_count, 10)
print(top_10)

# define a sightings threshold; produce a table with only birds belonging to major species
threshold <- top_10 %>%
  summarise(min_count = min(n)) %>%
  pull(min_count)

major_species_table <- Joined %>%
  filter(SpeciesName %in% top_10$SpeciesName)

print(major_species_table)

```


### Step 4

We now want to produce a month-by-month count for each of the major species, and then construct a chart to tell the story of what time of year the various species appear.

```{r}
# prepare glyph-ready data table called `ByMonth`
ByMonth <- major_species_table %>%
  group_by(SpeciesName, Month) %>%
  summarise(count = n()) %>%
  ungroup()


```

Now use the ggplot template below to generate the desired graph. (Remark you can also use esquisser or mplot to create a line chart instead of the barchart)



```{r}
# ggplot commands

ByMonth %>% 
  ggplot(aes(x = Month, y = count, color = SpeciesName)) + 
  geom_line()

ByMonth %>% ggplot(aes(x=Month,y=count ,fill=SpeciesName)) +
  geom_bar(stat='identity',position='stack', width=.9) 

```

According to the graph, we can answer the questions posed:

##### 1. Which species are present year-round?  

```{r}
year_round_species <- ByMonth %>%
  group_by(SpeciesName) %>%
  summarise(months_present = n_distinct(Month)) %>%
  filter(months_present == 12) %>%
  pull(SpeciesName)


print(year_round_species)
```
Therefore, from looking at the graph and analyzing it further using the aforementioned code, we can ascertain that the species that are present year round are:

* American Goldfinch
* Black-capped Chickadee
* White-breasted Nuthatch

##### 2. Which species are migratory, that is, primarily present in one or two seasons?




##### 3. What is the peak month for each major species? (bullet list)




##### 4. Which major species are seen in good numbers for at least 6 months of the year?



```{r}

```
